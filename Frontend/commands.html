<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Command Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        
        .results-box {
            background-color: #f9fafb;
            border-left: 4px solid #d1d5db;
            padding: 1rem;
            border-radius: 0.5rem;
        }
        
        pre {
            background-color: #f9fafb;
            border-left: 4px solid #d1d5db;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace; 
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="p-6">
    <div class="absolute top-6 right-6 z-10">
        <a href="e-commerce-dashboard.html" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300 transform hover:scale-105 shadow-lg">
            Go to Dashboard
        </a>
    </div>

    <div class="max-w-7xl mx-auto bg-white p-8 rounded-xl shadow-2xl">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-8">Database Command Interface</h1>
        <p class="text-center text-gray-500 mb-10 max-w-2xl mx-auto">
            This page allows you to execute raw SQL queries for MySQL and NoSQL commands for MongoDB. Enter a command in the text box below and click "Execute" to see the results.
        </p>

        <div class="bg-blue-100 border-l-4 border-blue-500 text-blue-800 p-6 rounded-lg mb-8 shadow-inner">
            <h2 class="text-3xl font-bold mb-4">MySQL Queries</h2>
            <form id="mysql-form" class="space-y-4">
                <textarea id="mysql-query" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 p-4 font-mono" rows="6" placeholder="Example: SELECT * FROM product_inventory;"></textarea>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-full transition-colors duration-300 transform hover:scale-105">Execute MySQL Query</button>
            </form>
            <div id="mysql-results-container" class="mt-6">
                <h3 class="text-xl font-semibold text-blue-900 mb-2">Results</h3>
                <div id="mysql-results" class="results-box overflow-x-auto"></div>
            </div>
        </div>

        <div class="bg-green-100 border-l-4 border-green-500 text-green-800 p-6 rounded-lg mb-8 shadow-inner">
            <h2 class="text-3xl font-bold mb-4">MongoDB Commands</h2>
            <form id="mongodb-form" class="space-y-4">
                <textarea id="mongodb-command" class="w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring focus:ring-green-500 focus:ring-opacity-50 p-4 font-mono" rows="6" placeholder="Example: find({})"></textarea>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-full transition-colors duration-300 transform hover:scale-105">Execute MongoDB Command</button>
            </form>
            <div id="mongodb-results-container" class="mt-6">
                <h3 class="text-xl font-semibold text-green-900 mb-2">Results</h3>
                <pre id="mongodb-results"></pre>
            </div>
        </div>
    </div>

    <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3 text-center">
                <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"></h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500" id="modal-message"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="close-modal-btn" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>

        const API_URL = 'http://localhost:3000/api';
        //const API_URL = 'https://bc42171063a8.ngrok-free.app/api'; 

        const mysqlForm = document.getElementById('mysql-form');
        const mysqlQueryInput = document.getElementById('mysql-query');
        const mysqlResults = document.getElementById('mysql-results');
        const mongodbForm = document.getElementById('mongodb-form');
        const mongodbCommandInput = document.getElementById('mongodb-command');
        const mongodbResults = document.getElementById('mongodb-results');
        const messageModal = document.getElementById('message-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const closeModalBtn = document.getElementById('close-modal-btn');

        function showMessage(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');
        }
        
        closeModalBtn.addEventListener('click', (e) => {
            e.preventDefault(); 
            e.stopPropagation(); 
            messageModal.classList.add('hidden'); 
        });

        function jsonToHtmlTable(data) {
            if (!data || data.length === 0) {
                return '<p class="text-gray-500">No results found.</p>';
            }

            const headers = Object.keys(data[0]);
            let tableHtml = '<table class="min-w-full divide-y divide-gray-200 border border-gray-200">';
            
            tableHtml += '<thead class="bg-gray-50">';
            tableHtml += '<tr>';
            headers.forEach(header => {
                tableHtml += `<th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header}</th>`;
            });
            tableHtml += '</tr>';
            tableHtml += '</thead>';

            tableHtml += '<tbody class="bg-white divide-y divide-gray-200">';
            data.forEach(row => {
                tableHtml += '<tr>';
                headers.forEach(header => {
                    const value = row[header];
                    let displayValue = value !== null && value !== undefined ? value : '';
                    if (typeof displayValue === 'number') {
                        if (displayValue % 1 !== 0) {
                            displayValue = displayValue.toFixed(4); 
                        }
                    }
                    tableHtml += `<td class="px-3 py-2 whitespace-nowrap text-sm text-gray-900">${displayValue}</td>`;
                });
                tableHtml += '</tr>';
            });
            tableHtml += '</tbody>';
            tableHtml += '</table>';

            return tableHtml;
        }

        mysqlForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = mysqlQueryInput.value.trim();
            if (!query) {
                showMessage("Error", "Please enter a MySQL query.");
                return;
            }

            mysqlResults.innerHTML = '<div class="text-gray-500">Executing query...</div>'; 

            try {
                const response = await fetch(`${API_URL}/mysql/query`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                const result = await response.json();
                if (response.ok) {
                    mysqlResults.innerHTML = jsonToHtmlTable(result.results); 
                    showMessage("Success", "Query executed successfully.");
                } else {
                    mysqlResults.innerHTML = `<pre class="text-red-600">${result.error || 'Unknown error'}</pre>`;
                    showMessage("Error", result.error || "Failed to execute MySQL query.");
                }
            } catch (error) {
                console.error('Network error:', error);
                mysqlResults.innerHTML = '<pre class="text-red-600">Error: Network error. Could not connect to the API.</pre>';
                showMessage("Error", "Network error. Could not connect to the API.");
            }
        });

        mongodbForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const command = mongodbCommandInput.value.trim();
            if (!command) {
                showMessage("Error", "Please enter a MongoDB command.");
                return;
            }

            mongodbResults.textContent = 'Executing command...';

            try {
                const response = await fetch(`${API_URL}/mongodb/command`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ command })
                });

                const result = await response.json();
                if (response.ok) {
                    mongodbResults.textContent = JSON.stringify(result.results, null, 2);
                    showMessage("Success", "Command executed successfully.");
                } else {
                    mongodbResults.textContent = `Error: ${result.error || 'Unknown error'}`;
                    showMessage("Error", result.error || "Failed to execute MongoDB command.");
                }
            } catch (error) {
                console.error('Network error:', error);
                mongodbResults.textContent = 'Error: Network error. Could not connect to the API.';
                showMessage("Error", "Network error. Could not connect to the API.");
            }
        });

    </script>
</body>
</html>