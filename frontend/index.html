<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸŒŸ The Next-Gen Store ğŸ›’</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="text-gray-800">

  <!-- Sidebar -->
  <aside id="sidebar" class="fixed top-0 left-0 w-64 h-full bg-indigo-700 text-white flex flex-col z-40">
    <div class="p-6 border-b border-indigo-500 flex justify-between items-center">
      <h1 class="text-xl font-bold">Next-Gen Store</h1>
      <button id="closeSidebar" class="text-white text-2xl font-bold">&times;</button>
    </div>
    <nav class="flex-grow p-4 space-y-2">
      <a href="#customer" id="customerLink" class="block px-4 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 transition">ğŸ› Customer View</a>
      <a href="admin.html" class="block px-4 py-2 rounded-lg hover:bg-indigo-500 transition">âš™ï¸ Admin View</a>
      <a href="commands.html" class="block px-4 py-2 rounded-lg hover:bg-indigo-500 transition">ğŸ’» Commands</a>
    </nav>
    <footer class="text-center text-xs text-indigo-300 p-4 border-t border-indigo-500">
      Â© 2025 Group 28 | INF2003
    </footer>
  </aside>

  <!-- Hamburger -->
  <button id="menuBtn" class="fixed top-5 left-5 bg-indigo-600 text-white p-2 rounded-md shadow-md z-50">â˜°</button>

  <!-- Welcome Section -->
  <section id="welcome" class="text-center px-6 min-h-screen flex flex-col justify-center">
    <h1 class="text-5xl md:text-6xl font-extrabold text-indigo-700 mb-4">ğŸŒŸ The Next-Gen Store ğŸ›’</h1>
    <p class="text-gray-600 text-lg max-w-2xl mb-8 mx-auto">
      A modern e-commerce dashboard to browse, buy, and manage your store effortlessly.
    </p>
    <!-- ğŸ”¹ Compact Start Browsing Button -->
    <a href="#customer" id="browseBtn" 
       class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm py-1 px-4 rounded-full shadow-sm transition transform hover:scale-105 inline-block mx-auto">
      Start Browsing
    </a>
    <!-- Scroll Down Indicator -->
    <div class="mt-16 animate-bounce text-gray-400 cursor-pointer transition-opacity duration-500" id="scrollDown">
      <span>â†“ Scroll down to explore more â†“</span>
    </div>
  </section>

  <!-- Customer Section -->
  <section id="customer" class="text-center px-6 py-32 flex flex-col justify-center min-h-screen">
    <h2 class="text-4xl font-bold text-indigo-700 mb-4">ğŸ› Customer View</h2>
    <p class="text-gray-500 mb-10 text-lg">Browse and purchase products from our store catalog.</p>

    <!-- Search Bar -->
    <div class="flex flex-col items-center mb-6 w-full px-4">
      <div class="flex w-full max-w-3xl mb-4">
        <input id="searchBox" 
               type="text" 
               placeholder="Search for products..." 
               class="flex-grow border border-indigo-300 rounded-l-lg p-3 text-lg focus:ring-2 focus:ring-indigo-400 outline-none" />
        <button id="searchBtn" 
                class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 text-lg font-semibold rounded-r-lg">
          ğŸ” Search
        </button>
      </div>
      <!-- Error Message -->
      <div id="errorMessage" class="text-red-600 font-semibold text-center mt-2 hidden"></div>
    </div>

    <!-- Product Grid -->
    <div id="productGrid" class="grid gap-10 sm:grid-cols-2 lg:grid-cols-3 max-w-6xl mx-auto"></div>

    <footer class="mt-20 text-sm text-gray-400">
      Â© 2025 Group 28 | INF2003 Database Systems
    </footer>
  </section>

  <script>
    const API_URL = "http://localhost:3000";

    // Sidebar toggle
    const sidebar = document.getElementById("sidebar");
    document.getElementById("menuBtn").onclick = () => sidebar.classList.add("active");
    document.getElementById("closeSidebar").onclick = () => sidebar.classList.remove("active");

    // Smooth scroll
    const scrollToCustomer = () => document.querySelector("#customer").scrollIntoView({ behavior: "smooth" });

    document.getElementById("browseBtn").addEventListener("click", e => {
      e.preventDefault();
      scrollToCustomer();
    });

    document.getElementById("scrollDown").addEventListener("click", e => {
      e.preventDefault();
      scrollToCustomer();
    });

    document.getElementById("customerLink").addEventListener("click", e => {
      e.preventDefault();
      scrollToCustomer();
      sidebar.classList.remove("active");
    });

    // Hide "Scroll Down" text when reaching Customer section
    window.addEventListener("scroll", () => {
      const customerSection = document.getElementById("customer");
      const scrollDown = document.getElementById("scrollDown");
      const rect = customerSection.getBoundingClientRect();

      if (rect.top <= window.innerHeight * 0.6) {
        scrollDown.style.opacity = "0";
        scrollDown.style.pointerEvents = "none";
      } else {
        scrollDown.style.opacity = "1";
        scrollDown.style.pointerEvents = "auto";
      }
    });

    // Auto-scroll if #customer in URL
    window.addEventListener("load", () => {
      if (window.location.hash === "#customer") scrollToCustomer();
    });

    const errorBox = document.getElementById("errorMessage");

    // Load products
    async function loadProducts(query = "") {
      const grid = document.getElementById("productGrid");
      grid.innerHTML = "<p class='text-gray-400 text-center'>Loading products...</p>";
      errorBox.classList.add("hidden");
      try {
        const res = await fetch(`${API_URL}/api/products`);
        if (!res.ok) throw new Error("Failed to fetch data from server.");
        const data = await res.json();
        const filtered = query
          ? data.filter(p => (p.title || "").toLowerCase().includes(query.toLowerCase()))
          : data;
        grid.innerHTML = filtered.length
          ? filtered.map(p => `
            <div class='bg-white rounded-xl shadow hover:shadow-2xl transition transform hover:scale-105 overflow-hidden'>
              <div class='bg-gray-100 h-48 flex items-center justify-center text-gray-400'>[Image]</div>
              <div class='p-5'>
                <h3 class='font-semibold text-lg text-gray-800'>${p.title || "Unnamed"}</h3>
                <p class='text-sm text-gray-500'>SKU: ${p.sku || p.product_id}</p>
                <p class='text-green-600 font-bold text-xl mt-2'>$${parseFloat(p.price || 0).toFixed(2)}</p>
                <button class='mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-lg font-semibold buy-btn' data-sku='${p.sku || p.product_id}'>Buy Now</button>
              </div>
            </div>`).join("")
          : "<p class='text-gray-500'>No products found.</p>";
      } catch (err) {
        errorBox.textContent = "Error: Failed to fetch data. Please check your backend connection.";
        errorBox.classList.remove("hidden");
        grid.innerHTML = "";
      }
    }

    document.getElementById("searchBtn").onclick = () => {
      const q = document.getElementById("searchBox").value.trim();
      loadProducts(q);
    };

    document.addEventListener("click", async e => {
      if (e.target.classList.contains("buy-btn")) {
        const sku = e.target.dataset.sku;
        if (confirm("Confirm purchase?")) {
          await fetch(`${API_URL}/api/products/${sku}`, { method: "DELETE" });
          loadProducts();
        }
      }
    });

    loadProducts();
  </script>
</body>
</html>
